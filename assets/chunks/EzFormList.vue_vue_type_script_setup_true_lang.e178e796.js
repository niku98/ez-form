import{b as x}from"./EzFormItem.vue_vue_type_script_setup_true_lang.8fbd04da.js";import{$ as M,f as ee,h as v,i as re,j as N,o as te,c as se,k as oe,l as ae,m as ne}from"./EzFormItemAutoBindingInput.vue_vue_type_script_setup_true_lang.9862bfc4.js";import{u as ie,l as b,q as K,w as P,p as O,f as le,o as ue,H as ce,I as me,J as G,D as H,A as t,E as fe}from"../app.64b81970.js";function de(o){ie(M,o)}function pe(o){const c=ee(o),{fieldMeta:n,handleChange:s,requiredMarkString:u,validate:i,resetFieldMeta:d,clearValidate:m,updateProps:g,props:f,injectedForm:L}=c,l=b(()=>n.transformedValue&&Array.isArray(n.transformedValue)?n.transformedValue:[]),h=b(()=>Array.isArray(f.name)?f.name:f.name?[f.name]:[]),k=b(()=>l.value.map((r,e)=>({key:v([...h.value,e]),index:e,getNamePath(a){return v([...h.value,e,...re(a)])}}))),E=b(()=>[]);function F(r){return te(L.fields).filter(({name:e})=>v(e).includes(v([...h.value,r])+"."))}function S(r){F(r).forEach(e=>{e.reset()})}function V(r){F(r).forEach(e=>{e.clearValidate()})}function $(r,e){return e=Array.isArray(e)?e:[e],v([...h.value,r,...e])}function I(r){return r===void 0?L.meta.errors:F(r).map(({error:e})=>e).filter(e=>!!e)}function j(r){return I(r).length>0}function w(r){const e=[...l.value];e.push(r),s(e)}function A(r,e){const a=[...l.value];a.splice(r,0,e),s(a)}function B(r){const e=[...l.value];e.unshift(r),s(e)}function q(){const r=[...l.value],e=r.pop();return s(r),e}function p(){const r=[...l.value],e=r.shift();return s(r),e}function z(r){const e=[...l.value];e.splice(r,1),s(e)}function T(r,e){const a=[...l.value],y=a.findIndex(Z=>Z[r]===e);y>-1&&a.splice(y,1),s(a)}function U(r,e){const a=[...l.value];a[r]=e,s(a)}function W(r,e){const a=[...l.value],y=a[r];a[r]=a[e],a[e]=y,s(a)}function Q(r,e){const a=[...l.value],y=a[r];a.splice(r,1),a.splice(e,0,y),s(a)}const J={props:f,meta:n,requiredMarkString:u,listValues:l,namePrefix:h,fields:k,errors:E,reset:d,registerFormField:_,unRegisterFormField:D,updateProps:g,getItemFields:F,resetItem:S,clearItemValidate:V,validate:i,clearValidate:m,getNamePath:$,getErrors:I,hasError:j,add:w,insert:A,unshift:B,pop:q,shift:p,remove:z,removeByKey:T,replace:U,swap:W,move:Q},C=K(()=>{}),X=ve(n,J),Y=K(()=>()=>{}),R=K(()=>{});function _(r){R.value(),C.value(),c.registerFormField(r),R.value=Y.value(),C.value=X()}function D(r){c.unRegisterFormField(r),R.value(),C.value()}return _(),P(()=>f.name,(r,e)=>{e&&D(e),_()}),O(()=>{D()}),J}function ve(o,c){return O(()=>{if(!o.name)return;const n=N[o.formName];if(!n)return;const s=v(o.name);n.lists&&delete n.lists[s]}),()=>{const n=o.formName,s=o.formName,u=P(()=>o.name,(i,d)=>{N[o.formName]||(N[o.formName]={});const m=N[o.formName];if(!m)return;if(d){const f=v(d);m.lists&&delete m.lists[f]}if(!i)return;const g=v(i);m.lists?m.lists[g]=c:m.lists={[g]:c}},{immediate:!0});return()=>{if(!s)return;const i=N[n];if(!i)return;const d=v(s);i.lists&&delete i.lists[d],u()}}}function ge(o,c){var u;const n=se(),s=(u=o.formList)!=null?u:pe(o);return o.formList&&(s.unRegisterFormField(),s.updateProps(o),s.registerFormField(n),P(o,oe(()=>{s.updateProps(o)},500))),P(()=>s.meta.rawValue,i=>{c("change",ae(i),n)}),de(s),{formListInstance:s,formInstance:n}}const Ne=le({__name:"EzFormList",props:ne(),emits:["change"],setup(o,{expose:c,emit:n}){const s=o,{formListInstance:u,formInstance:i}=ge(s,n),{meta:d,requiredMarkString:m,listValues:g,fields:f,errors:L,getErrors:l,getNamePath:h,hasError:k,add:E,pop:F,insert:S,unshift:V,shift:$,remove:I,removeByKey:j,swap:w,replace:A,move:B}=u,q=b(()=>`${i.classPrefix}-form-list`);return c(u),(p,z)=>(ue(),ce(x,{class:fe(t(q)),label:p.label,"id-for":t(d).id,"required-mark":t(m),"no-style":p.noStyle},me({default:G(()=>[H(p.$slots,"default",{value:t(g),length:t(g).length,fields:t(f),getNamePath:t(h),errors:t(L),getErrors:t(l),hasError:t(k),add:t(E),insert:t(S),unshift:t(V),shift:t($),pop:t(F),remove:t(I),removeByKey:t(j),swap:t(w),replace:t(A),move:t(B),form:t(i)})]),_:2},[p.$slots.errors?{name:"errors",fn:G(()=>[H(p.$slots,"errors",{error:t(d).error,form:t(i),formList:t(u)})]),key:"0"}:void 0,p.$slots.extra?{name:"extra",fn:G(()=>[H(p.$slots,"extra",{form:t(i),formList:t(u)})]),key:"1"}:void 0]),1032,["class","label","id-for","required-mark","no-style"]))}});export{Ne as _,pe as u};
